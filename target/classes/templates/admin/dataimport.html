<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="_csrf" th:content="${_csrf.token}">
	<meta name="_csrf_header" th:content="${_csrf.headerName}">
	<title>CSVãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆã¨ãƒ‡ãƒ¼ã‚¿ç®¡ç†</title>
	    
	<link rel="stylesheet" 
	          th:href="@{/css/style.css}" 
	          href="/css/style.css">
    
    <style>
        /* æ—¢å­˜ã®Thymeleafãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¹ã‚¿ã‚¤ãƒ«ã¯æ®‹ã—ã€JSå´ã§éè¡¨ç¤ºã«ã—ã¾ã™ */
        /* JSã§åˆ¶å¾¡ã™ã‚‹å›ºå®šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒ†ã‚­ã‚¹ãƒˆã«ã¯ã€ã“ã®ã‚¹ã‚¿ã‚¤ãƒ«ãŒé©ç”¨ã•ã‚Œãªã„ã‚ˆã†ã«æ³¨æ„ */
        .message-success { color: green; font-weight: bold; padding: 10px; border: 1px solid green; margin-bottom: 15px; }
        .message-error { color: red; font-weight: bold; padding: 10px; border: 1px solid red; margin-bottom: 15px; }
        
        /* ã‚¿ãƒ–è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ã¯æ®‹ã—ã¾ã™ */
        .tab-contents .content {
            display: none;
        }
        #tab1:checked ~ .tab-contents #content1,
        #tab2:checked ~ .tab-contents #content2,
        #tab3:checked ~ .tab-contents #content3 {
            display: block;
        }
    </style>
</head>
<body th:data-user-role="${#authorization.expression('hasAuthority(''ADMIN'')') ? 'ADMIN' : 'USER'}">
	
	<div id="custom-tooltip" class="custom-tooltip"></div>
	
	<div id="notification-toast" class="notification-toast">
        <span id="notification-message"></span>
    </div>
    
    <div class="excel-container">
	    
	    <input type="radio" name="tabs" id="tab1" checked>
	    <input type="radio" name="tabs" id="tab2">
	    <input type="radio" name="tabs" id="tab3">

	    <div class="tabs">
	        <label for="tab1" class="tab-label">é§è»Šå ´äºˆç´„ãƒªã‚¹ãƒˆ</label>
	        <label for="tab2" class="tab-label">æ¥é¤¨è€…äºˆç´„ãƒªã‚¹ãƒˆ</label>
	        <label for="tab3" class="tab-label">é€è¿ãƒã‚¹é‹è¡Œãƒªã‚¹ãƒˆ</label>
	        
	        <form th:action="@{/logout}" method="post" class="logout-form">
	            <button type="submit" class="logout-button">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
	        </form>
	        <div class="tab-line"></div>
	    </div>
	    
	    <div class="tab-contents">
			<section id="content1" class="content">
			    
                <div class="content-header">
			        <h2>ğŸš™ 1é§è»Šå ´äºˆç´„ãƒªã‚¹ãƒˆ</h2>
			        <div id="last-operation-result-tab1" class="last-operation-result">
                        <span id="result-span-tab1">--- æœ€æ–°ã®æ“ä½œçµæœ ---</span>
                    </div>
                </div>
                <p>CSVã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦é§è»Šå ´äºˆç´„ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãã¾ã™ã€‚</p>
                
				<div th:if="${message} and ${messageFor == 'parking'}" 
				         th:class="${message.contains('æˆåŠŸ') ? 'message-success' : 'message-error'}" 
				         th:text="${message}"
                         style="display: block;"> </div>
			    
                <form th:action="@{/dataimport/upload/parking}" method="post" enctype="multipart/form-data" class="csv-import-form">
			        <input type="file" name="file" accept=".csv"><br>
			        <button type="submit">é§è»Šå ´äºˆç´„CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
			    </form>
			    <hr>
			    
				<div class="table-wrapper">
				    <table class="excel-table">
				        <thead>
				            <tr>
				                <th>é§è»Šå ´äºˆç´„ãƒªã‚¹ãƒˆID</th>
				                <th>æ¥é¤¨äºˆå®šæ—¥æ™‚</th>
				                <th>ç”¨ä»¶ã¨ç¶šæŸ„</th>
				                <th>è»Šä¸¡ãƒŠãƒ³ãƒãƒ¼</th>
				                <th>æ¥é¤¨è€…æ°å</th>
				                <th>å‚åˆ—å®¶å</th>
				                <th>æ‹…å½“</th>
				                <th>å‡ºåº«æ™‚åˆ»</th>
				                <th>é§è»Šè¨¼No.</th>
				                <th>é§è»Šä½ç½®</th>
				                <th>åˆ©ç”¨çŠ¶æ³</th>
				                <th>æ›´æ–°æ—¥æ™‚</th>
				                <th>å‚™è€ƒæ¬„</th>
				            </tr>
				        </thead>
				        <tbody>
				            <tr th:each="parking : ${parkings}" th:attr="data-parking-id=${parking.id}">
				                <td data-label="é§è»Šå ´äºˆç´„ãƒªã‚¹ãƒˆ" class="group-1-col js-list-id-field" th:text="${parking.id}"></td>
				                <td data-label="æ¥é¤¨äºˆå®šæ—¥æ™‚" class="group-1-col" 
				                    th:text="${parking.visitReservationTime != null ? #temporals.format(parking.visitReservationTime, 'yyyy/MM/dd HH:mm') : '-'}"></td>
				                <td data-label="ç”¨ä»¶ã¨ç¶šæŸ„" class="group-1-col" th:text="${parking.errandsRelationship}"></td>
				                <td data-label="è»Šä¸¡ãƒŠãƒ³ãƒãƒ¼" class="js-vehicle-number-field group-1-col" th:data-record-id="${parking.id}">
				                    <span class="vehicle-number-text" th:text="${parking.carNumber}" th:data-original-value="${parking.carNumber}"></span>
				                    <form class="vehicle-number-edit-form" style="display: none; visibility: hidden;">
				                        <input type="hidden" name="record_id" th:value="${parking.id}" class="js-record-id">
				                        <input type="text" th:value="${parking.carNumber}" class="vehicle-number-input js-input-value">
				                        <button type="button" class="update-vehicle-button js-update-vehicle-button">æ›´æ–°</button> 
				                        <button type="button" class="cancel-vehicle-button js-cancel-vehicle-button">å–æ¶ˆ</button>
				                    </form>
				                </td>
				                <td data-label="æ¥é¤¨è€…æ°å" class="group-1-col" th:text="${parking.visitorName}"></td>
				                <td data-label="å‚åˆ—å®¶å" class="group-1-col" th:text="${parking.familyNames}"></td>
				                <td data-label="æ‹…å½“" class="group-1-col" th:text="${parking.managerName}"></td>
				                <td data-label="å‡ºåº«æ™‚åˆ»" class="js-exit-time-field group-1-col" 
				                    th:text="${parking.departureTime != null ? #temporals.format(parking.departureTime, 'yyyy/MM/dd HH:mm') : ''}"></td>
				                <td data-label="é§è»Šè¨¼No." class="js-permit-number group-2-col" th:text="${parking.parkingPermit}" th:data-value="${parking.parkingPermit}"></td>
				                <td data-label="é§è»Šä½ç½®" class="js-permit-location group-2-col" th:text="${parking.parkingPosition}" th:data-value="${parking.parkingPosition}"></td>
				                <td data-label="åˆ©ç”¨çŠ¶æ³" 
				                    class="js-parking-status group-2-col"
				                    th:attr="data-status-id=${parking.parkingStatus.statusId}">
				                    <span class="view-mode-text status-red-bold" th:text="${parking.parkingStatus.statusName}"></span>
				                    <div class="edit-mode-select" style="display: none; white-space: nowrap;">
				                        <select class="form-select form-select-sm situation-select">
				                            <option th:each="status : ${parkingStatuses}" 
				                                    th:value="${status.statusId}"  
				                                    th:text="${status.statusName}"
				                                    th:selected="${status.statusId == parking.parkingStatus.statusId}"></option>
				                        </select>
				                        <button class="btn btn-primary btn-sm js-update-button" data-field-name="parkingStatus" style="margin-left: 5px;">æ›´æ–°</button> 
				                        <button class="btn btn-secondary btn-sm js-cancel-button">å–æ¶ˆ</button>
				                    </div>
				                </td>
				                <td data-label="æ›´æ–°æ—¥æ™‚" class="js-update-time-field group-2-col js-update-time-field" 
				                    th:text="${#temporals.format(parking.updateTime, 'yyyy/MM/dd HH:mm')}"></td>
				                <td data-label="å‚™è€ƒæ¬„" class="js-remarks-field group-2-col" th:data-record-id="${parking.id}">
				                    <span class="remarks-text" th:text="${parking.remarksColumn}"></span>
				                    <form class="remarks-edit-form" style="display: none; visibility: hidden;">
				                        <textarea class="remarks-textarea" th:data-original-value="${parking.remarksColumn}" th:text="${parking.remarksColumn}"></textarea>
				                        <button type="submit" class="update-remarks-button">æ›´æ–°</button> 
				                        <button type="button" class="cancel-remarks-button">å–æ¶ˆ</button>
				                    </form>
				                </td>
				            </tr>
				            <tr th:if="${#lists.isEmpty(parkings)}" class="no-data-row">
				                <td colspan="13">ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹é§è»Šå ´äºˆç´„ãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚Šã¾ã›ã‚“ (PC)</td>
				            </tr>
				            <tr th:if="${#lists.isEmpty(parkings)}" class="no-data-row-mobile">
				                <td colspan="13" data-label="">ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹é§è»Šå ´äºˆç´„ãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚Šã¾ã›ã‚“</td> 
				            </tr>
				        </tbody>
				    </table>
				</div>
			</section>
            
			<section id="content2" class="content">
			    
                <div class="content-header">
			        <h2>ğŸ  2æ¥é¤¨è€…äºˆç´„ãƒªã‚¹ãƒˆ</h2>
			        <div id="last-operation-result-tab2" class="last-operation-result">
                        <span id="result-span-tab2">--- æœ€æ–°ã®æ“ä½œçµæœ ---</span>
                    </div>
                </div>
                <p>CSVã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦æ¥é¤¨è€…äºˆç´„ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãã¾ã™ã€‚</p>

				<div th:if="${message} and ${messageFor == 'visit'}" 
				         th:class="${message.contains('æˆåŠŸ') ? 'message-success' : 'message-error'}" 
				         th:text="${message}"
                         style="display: block;">
				</div>
				
                <form th:action="@{/dataimport/upload/visit}" method="post" enctype="multipart/form-data" class="csv-import-form">
			        <input type="file" name="file" accept=".csv"><br>
			        <button type="submit">æ¥é¤¨è€…äºˆç´„CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
			    </form>
			    <hr>
			    
				<div class="table-wrapper">
				    <table class="excel-table">
				        <thead>
				            <tr>
				                <th>æ¥é¤¨è€…äºˆç´„ãƒªã‚¹ãƒˆID</th>
				                <th>æ¥é¤¨äºˆå®šæ—¥æ™‚</th>
				                <th>ç”¨ä»¶</th>
				                <th>æ¥é¤¨è€…æ°å</th>
				                <th>å‚åˆ—å®¶å</th>
				                <th>æ‹…å½“</th>
				                <th>å¯¾å¿œå®Œäº†æ™‚åˆ»</th>
				                <th>æ¥é¤¨çŠ¶æ³</th>
				                <th>æ›´æ–°æ—¥æ™‚</th>
				                <th>å‚™è€ƒæ¬„</th>
				            </tr>
				        </thead>
				        <tbody>
				            <tr th:each="visit : ${visits}" th:attr="data-visit-id=${visit.id}">
				                <td data-label="æ¥é¤¨è€…äºˆç´„ãƒªã‚¹ãƒˆ" class="group-1-col js-list-id-field" th:text="${visit.id}"></td>
				                
				                <td data-label="æ¥é¤¨äºˆå®šæ—¥æ™‚" class="group-1-col" th:text="${visit.visitReservationTime != null ? #temporals.format(visit.visitReservationTime, 'yyyy/MM/dd HH:mm') : '-'}"></td>
				                <td data-label="ç”¨ä»¶" class="group-1-col" th:text="${visit.errandsRelationship}"></td>
				                <td data-label="æ¥é¤¨è€…æ°å" class="group-1-col" th:text="${visit.visitorName}"></td>
				                <td data-label="å‚åˆ—å®¶å" class="group-1-col" th:text="${visit.familyNames}"></td>
				                <td data-label="æ‹…å½“" class="group-1-col" th:text="${visit.managerName}"></td>
				                
				                <td data-label="å¯¾å¿œå®Œäº†æ™‚åˆ»" class="group-2-col js-compilation-cmp-time-field" th:text="${visit.compilationCmpTime != null ? #temporals.format(visit.compilationCmpTime, 'yyyy/MM/dd HH:mm') : ''}"></td>
				                
				                <td data-label="æ¥é¤¨çŠ¶æ³" class="js-visit-situation group-2-col" 
				                        th:data-situation-id="${visit.visitSituation != null ? visit.visitSituation.id : ''}"
				                        th:data-record-id="${visit.id}" 
				                        style="position: relative;"> 
				                        
				                        <span class="view-mode-text status-red-bold" 
				                                th:text="${visit.visitSituation != null ? visit.visitSituation.situationName : '-'}"></span>
				                                                                    
				                    <div class="edit-mode-select" style="display: none; white-space: nowrap;">
				                                                                        
				                        <select class="form-select form-select-sm situation-select">
				                            <option th:each="situation : ${visitSituations}" 
				                                th:value="${situation.id}"  
				                                th:text="${situation.situationName}"
				                                th:selected="${visit.visitSituation != null and situation.id == visit.visitSituation.id}">
				                            </option>
				                        </select>
				                                                                        
				                        <button class="btn btn-primary btn-sm js-update-button-visit" data-field-name="visitSituation" 
				                                style="margin-left: 5px;">æ›´æ–°</button> 
				                        <button type="button" class="btn btn-secondary btn-sm js-cancel-button-visit">å–æ¶ˆ</button> 
				                    </div>
				                </td>
				                <td data-label="æ›´æ–°æ—¥æ™‚" class="group-2-col js-update-time-field" th:text="${visit.updateTime != null ? #temporals.format(visit.updateTime, 'yyyy/MM/dd HH:mm') : ''}"></td>
				                
				                <td data-label="å‚™è€ƒæ¬„" class="js-remarks-field-visit group-2-col" th:data-record-id="${visit.id}">
				                    <span class="remarks-text" th:text="${visit.remarksColumn}"></span>
				                                                                    
				                        <form class="remarks-edit-form" style="display: none; visibility: hidden;">
				                            <textarea class="remarks-textarea" th:data-original-value="${visit.remarksColumn}" th:text="${visit.remarksColumn}"></textarea>
				                        <button type="submit" class="update-remarks-button-visit">æ›´æ–°</button>
				                        <button type="button" class="cancel-remarks-button-visit">å–æ¶ˆ</button>
				                        </form>
				                </td>																					
				            </tr>
				            <tr th:if="${#lists.isEmpty(visits)}" class="no-data-row">
				                <td colspan="10">ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹æ¥é¤¨è€…äºˆç´„ãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚Šã¾ã›ã‚“ (PC)</td>
				            </tr>
				            <tr th:if="${#lists.isEmpty(visits)}" class="no-data-row-mobile">
				                <td colspan="10" data-label="">ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹æ¥é¤¨è€…äºˆç´„ãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚Šã¾ã›ã‚“</td> 
				            </tr>
				        </tbody>
				    </table>
				</div>
			</section>
            
			<section id="content3" class="content">
			    
                <div class="content-header">
			        <h2>ğŸšŒ 3é€è¿ãƒã‚¹é‹è¡Œãƒªã‚¹ãƒˆ</h2>
			        <div id="last-operation-result-tab3" class="last-operation-result">
                        <span id="result-span-tab3">--- æœ€æ–°ã®æ“ä½œçµæœ ---</span>
                    </div>
                </div>
                <p>CSVã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦é€è¿ãƒã‚¹é‹è¡Œãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãã¾ã™ã€‚</p>

				<div th:if="${message} and ${messageFor == 'bus'}" 
				         th:class="${message.contains('æˆåŠŸ') ? 'message-success' : 'message-error'}" 
				         th:text="${message}"
                         style="display: block;">
				</div>			
				
                <form th:action="@{/dataimport/upload/bus}" method="post" enctype="multipart/form-data" class="csv-import-form">
			        <input type="file" name="file" accept=".csv"><br>
			        <button type="submit">é€è¿ãƒã‚¹é‹è¡ŒCSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
			    </form>
			    <hr>
			    
				<div class="table-wrapper">
					<table class="excel-table">
					        <thead>
					            <tr>
					                <th>é€è¿ãƒã‚¹é‹è¡Œãƒªã‚¹ãƒˆID</th>
					                <th>å‚åˆ—è€…åˆ°ç€äºˆå®šæ—¥æ™‚</th>
					                <th>é‹è¡Œãƒã‚¹ä¼šç¤¾åï¼ˆå®šå“¡ï¼‰</th>
					                <th>ç™ºç€çµ‚ç€å ´æ‰€</th>
					                <th>ä¸‹è»Šæ¸ˆãƒã‚¹å‡ºåº«æ™‚åˆ»</th>
					                <th>å‚åˆ—è€…å‡ºç™ºäºˆå®šæ™‚åˆ»</th>
					                <th>ä¹—è»Šæ¸ˆãƒã‚¹å‡ºåº«æ™‚åˆ»</th>
					                <th>æ‰‹é…ä¸¡å®¶å</th>
					                <th>æ‹…å½“</th>
					                <th>ä¹—è»Šæ•°</th>
					                <th>å…¥å‡ºåº«çŠ¶æ³</th>
					                <th>æ›´æ–°æ—¥æ™‚</th>
					                <th>å‚™è€ƒæ¬„</th>
					            </tr>
					        </thead>
					        <tbody>
					            <tr th:each="bus : ${busReservations}">
					                <td data-label="é€è¿ãƒã‚¹é‹è¡Œãƒªã‚¹ãƒˆ" class="group-1-col js-list-id-field" th:text="${bus.id}"></td>
					                
					                <td data-label="å‚åˆ—è€…åˆ°ç€äºˆå®šæ—¥æ™‚" class="group-1-col" th:text="${bus.visitReservationTime != null ? #temporals.format(bus.visitReservationTime, 'yyyy/MM/dd HH:mm') : ''}"></td>
					                <td data-label="é‹è¡Œãƒã‚¹ä¼šç¤¾åï¼ˆå®šå“¡ï¼‰" class="group-1-col" th:text="${bus.busName}"></td>
					                <td data-label="ç™ºç€çµ‚ç€å ´æ‰€" class="group-1-col" th:text="${bus.busDestination}"></td>
					                <td data-label="ä¸‹è»Šæ¸ˆãƒã‚¹å‡ºåº«æ™‚åˆ»" class="group-1-col" th:text="${bus.emptybusDepTime != null ? #temporals.format(bus.emptybusDepTime, 'yyyy/MM/dd HH:mm') : ''}"></td>
					                <td data-label="å‚åˆ—è€…å‡ºç™ºäºˆå®šæ™‚åˆ»" class="group-2-col" th:text="${bus.scheduledDepTime != null ? #temporals.format(bus.scheduledDepTime, 'yyyy/MM/dd HH:mm') : ''}"></td>
					                <td data-label="ä¹—è»Šæ¸ˆãƒã‚¹å‡ºåº«æ™‚åˆ»" class="group-2-col" th:text="${bus.departureTime != null ? #temporals.format(bus.departureTime, 'yyyy/MM/dd HH:mm') : ''}"></td>
					                <td data-label="æ‰‹é…ä¸¡å®¶å" class="group-2-col" th:text="${bus.familyNames}"></td>
					                <td data-label="æ‹…å½“" class="group-2-col" th:text="${bus.managerName}"></td>
									<td data-label="ä¹—è»Šæ•°" class="js-passengers-field group-2-col" th:data-record-id="${bus.id}">
									    <span class="passengers-text" th:text="${bus.passengers} + 'å'" th:data-original-value="${bus.passengers}"></span>
									    
									    <form class="passengers-edit-form" style="display: none; visibility: hidden;">
									        <input type="number" 
									               th:value="${bus.passengers}" 
									               class="passengers-input js-input-value" 
									               min="0" 
									               pattern="[0-9]*"
									               style="width: 60px;">
									        <button type="button" class="update-passengers-button js-update-passengers-button">æ›´æ–°</button> 
									        <button type="button" class="cancel-passengers-button js-cancel-passengers-button">å–æ¶ˆ</button>
									    </form>
									</td>
									<td data-label="å…¥å‡ºåº«çŠ¶æ³" 
									    class="js-bus-status group-2-col" 
									    th:attr="data-status-id=${bus.busSituation.id}, data-status-name=${bus.busSituation.name}, data-record-id=${bus.id}">
									    
									    <span class="view-mode-text status-red-bold" th:text="${bus.busSituation.name}"></span>
									    
									    <div class="edit-mode-select" style="display: none; white-space: nowrap;">
									        <select class="form-select form-select-sm situation-select js-bus-situation-select">
									            <option th:each="status : ${busSituations}" 
									                    th:value="${status.id}"  
									                    th:text="${status.name}"
									                    th:selected="${status.id == bus.busSituation.id}"></option>
									        </select>
									        
									        <button class="btn btn-primary btn-sm js-update-button-bus" 
									                data-field-name="busSituation" 
									                style="margin-left: 5px;">æ›´æ–°</button> 
									                
									        <button class="btn btn-secondary btn-sm js-cancel-button-bus">å–æ¶ˆ</button>
									    </div>
									</td>
					                
					                <td data-label="æ›´æ–°æ—¥æ™‚" class="group-2-col js-update-time-field" th:text="${bus.updateTime != null ? #temporals.format(bus.updateTime, 'yyyy/MM/dd HH:mm') : ''}"></td>
					                
					                <td data-label="å‚™è€ƒæ¬„" class="js-remarks-field group-2-col" th:data-record-id="${bus.id}">
					                    <span class="remarks-text" th:text="${bus.remarksColumn}"></span>
					                    
					                    <form class="remarks-edit-form" style="display: none; visibility: hidden;">
					                        <textarea class="remarks-textarea" 
					                                    th:data-original-value="${bus.remarksColumn}" 
					                                    th:text="${bus.remarksColumn}"></textarea>
					                        <button type="submit" class="update-remarks-button">æ›´æ–°</button>
					                        <button type="button" class="cancel-remarks-button">å–æ¶ˆ</button>
					                    </form>
					                </td>
					            </tr>
					        </tbody>
					    </table>
					</div>
			</section>
		</div>
	</div>
		
	<script th:src="@{/js/common.js}" src="/js/common.js"></script>
	<script th:src="@{/js/parking.js}" src="/js/parking.js"></script>
	<script th:src="@{/js/visitor.js}" src="/js/visitor.js"></script>
	<script th:src="@{/js/bus.js}" src="/js/bus.js"></script>
	
	<script>
	document.addEventListener('DOMContentLoaded', function() {
	    // 1. URLã‹ã‚‰ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—
	    const urlParams = new URLSearchParams(window.location.search);
	    const activeTabId = urlParams.get('activeTab'); // ä¾‹: 'tab2' ã‚’å–å¾—

	    if (activeTabId) {
	        // 2. ç¾åœ¨ã® checked çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆã—ã€æŒ‡å®šã•ã‚ŒãŸIDã®ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã‚’ checked ã«ã™ã‚‹
	        document.querySelectorAll('input[name="tabs"]').forEach(radio => {
	            radio.checked = false;
	        });
	        
	        // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§æŒ‡å®šã•ã‚ŒãŸã‚¿ãƒ–ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹
	        const targetTab = document.getElementById(activeTabId);
	        if (targetTab) {
	            targetTab.checked = true;
	        }
	        
	        // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¦ã€ç”»é¢ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã«ä¿ã¤
	        // history.replaceState(null, '', window.location.pathname);
	    }
	    
	    // â˜…â˜…â˜… æ—¢å­˜ã®Thymeleafãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’JavaScriptã§å‡¦ç†ã—ã€å›ºå®šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«åæ˜ ã•ã›ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ â˜…â˜…â˜…
	    const thymeleafMessages = document.querySelectorAll('.message-success, .message-error');

	    if (thymeleafMessages.length > 0) {
	        // Thymeleafãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒä¸€ã¤ã§ã‚‚ã‚ã‚Œã°ã€ãã‚Œã‚’ãƒˆãƒ¼ã‚¹ãƒˆ/å›ºå®šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«è¡¨ç¤º
	        const messageElement = thymeleafMessages[0];
	        const messageText = messageElement.textContent.trim();
	        const isSuccess = messageElement.classList.contains('message-success');
	        const type = isSuccess ? 'success' : 'error';
	        
	        // ğŸ’¡ æ—¢å­˜ã®Thymeleafãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‚¿ãƒ–ã‚’ç‰¹å®š
	        let tabIdForCsv = 'tab1'; 
            let resultSpanId = 'result-span-tab1';

            if (document.getElementById('content2').contains(messageElement)) {
                tabIdForCsv = 'tab2';
                resultSpanId = 'result-span-tab2';
            } else if (document.getElementById('content3').contains(messageElement)) {
                tabIdForCsv = 'tab3';
                resultSpanId = 'result-span-tab3';
            }
	        
            // 3. å›ºå®šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è»¢è¨˜
            const resultSpan = document.getElementById(resultSpanId);
            if (resultSpan) {
                resultSpan.textContent = messageText;
                resultSpan.style.color = isSuccess ? 'green' : 'red';
                resultSpan.style.fontWeight = 'bold';
            }

	        // 4. common.js ã«å®šç¾©ã•ã‚ŒãŸ showNotificationToast (ã¾ãŸã¯ showNotification) é–¢æ•°ã‚’æƒ³å®šã—ã€è¡¨ç¤º
	        if (typeof showNotificationToast === 'function') {
	             showNotificationToast(messageText, type); 
	        } else if (typeof showNotification === 'function') {
                 // showNotification(message, type, tabIdForCsv) ã®å½¢å¼ã‚’æƒ³å®š
                 showNotification(messageText, type, tabIdForCsv); 
            }

	        // 5. Thymeleafã§è¡¨ç¤ºã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã€å›ºå®šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«è»¢è¨˜å¾Œã€éè¡¨ç¤ºã«ã™ã‚‹
	        messageElement.style.display = 'none';
	    }
	});
	</script>
</body>
</html>